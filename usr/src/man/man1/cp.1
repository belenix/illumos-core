.\" Copyright 2014 Garrett D'Amore <garrett@damore.org>
.\" Copyright 2013 Nexenta Systems, Inc. All rights reserved.
.\" Copyright (c) 1992, X/Open Company Limited All Rights Reserved
.\" Copyright 1989 AT&T
.\" Portions Copyright (c) 2007, Sun Microsystems, Inc. All Rights Reserved
.\" Sun Microsystems, Inc. gratefully acknowledges The Open Group for permission to reproduce portions of its copyrighted documentation. Original documentation from The Open Group can be obtained online at
.\" http://www.opengroup.org/bookstore/.
.\" The Institute of Electrical and Electronics Engineers and The Open Group, have given us permission to reprint portions of their documentation. In the following statement, the phrase "this text" refers to portions of the system documentation. Portions of this text are reprinted and reproduced in electronic form in the Sun OS Reference Manual, from IEEE Std 1003.1, 2004 Edition, Standard for Information Technology -- Portable Operating System Interface (POSIX), The Open Group Base Specifications Issue 6, Copyright (C) 2001-2004 by the Institute of Electrical and Electronics Engineers, Inc and The Open Group. In the event of any discrepancy between these versions and the original IEEE and The Open Group Standard, the original IEEE and The Open Group Standard is the referee document. The original Standard can be obtained online at http://www.opengroup.org/unix/online.html.
.\"  This notice shall appear on any product containing this material.
.\" The contents of this file are subject to the terms of the Common Development and Distribution License (the "License").  You may not use this file except in compliance with the License.
.\" You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE or http://www.opensolaris.org/os/licensing.  See the License for the specific language governing permissions and limitations under the License.
.\" When distributing Covered Code, include this CDDL HEADER in each file and include the License file at usr/src/OPENSOLARIS.LICENSE.  If applicable, add the following below this CDDL HEADER, with the fields enclosed by brackets "[]" replaced with your own identifying information: Portions Copyright [yyyy] [name of copyright owner]
.Dd Dec 12, 2014
.Dt CP 1
.Os
.Sh NAME
.Nm cp
.Nd copy files
.Sh SYNOPSIS
.
.Nm
.Op Fl afip@/
.Ar source_file
.Ar target_file
.
.Nm
.Op Fl afip@/
.Ar source_file No ...
.Ar target
.
.Nm
.Fl R
.Op Fl H | Fl L | Fl P
.Op Fl afip@/
.Ar source_dir No ...
.Ar target
.
.Nm
.Fl r
.Op Fl H | Fl L | Fl P
.Op Fl afip@/
.Ar source_dir No ...
.Ar target
.
.Sh DESCRIPTION
In the first synopsis form, neither
.Ar source_file
nor
.Ar target_file
are directory files, nor can they have the same name.
The
.Nm
utility copies the contents of
.Ar source_file
to the destination path named by
.Ar target_file .
If
.Ar target_file
exists,
.Nm
overwrites its contents, but the mode (and
.Sy ACL
if applicable), owner, and group associated with it are not changed.
The last modification time of
.Ar target_file
and the last access time of
.Ar source_file
are set to the time the copy was made.
If
.Ar target_file
does not exist,
.Nm
creates a new file named
.Ar target_file
that has the same mode as
.Ar source_file
except that the sticky bit is not set unless the user is super-user.
In this case, the owner and group of
.Ar target_file
are those of the user, unless
the setgid bit is set on the directory containing the newly created file.
If the directory's setgid bit is set, the newly created file has the group of
the containing directory rather than of the creating user.
If
.Ar target_file
is a link to another file,
.Nm
overwrites the link destination with the contents of
.Ar source_file ;
the link(s) from
.Ar target_file
remains.
.Pp
In the second synopsis form, one or more
.Ar source_file Ns No s
are copied to the directory specified by
.Ar target .
It is an error if any
.Ar source_file
is a file of type directory, if
.Ar target
either does not exist or is not a directory.
.Pp
In the third or fourth synopsis forms, one or more directories specified by
.Ar source_dir
are copied to the directory specified by
.Ar target .
Either the
.Fl r
or
.Fl R
must be specified.
For each
.Ar source_dir ,
.Nm
copies all files and subdirectories.
.
.Sh OPTIONS
The following options are supported:
.
.Bl -tag -width Fl
.It Fl a
Archive mode.
Same as
.Fl RpP .
.
.It Fl f
Unlink.
If a file descriptor for a destination file cannot be obtained, this
option attempts to unlink the destination file and proceed.
.
.It Fl H
Takes actions based on the type and contents of the file referenced by any
symbolic link specified as a
.Ar source_file
operand.
.Pp
If the
.Ar source_file
operand is a symbolic link, then
.Nm
copies the file referenced by the symbolic link for the
.Ar source_file
operand.
All other symbolic links encountered during traversal of a file hierarchy are
preserved.
.
.It Fl i
Interactive.
The
.Nm
utility prompts for confirmation whenever the copy would overwrite an existing
.Ar target .
An affirmative response means that the copy should proceed.
Any other answer prevents
.Nm
from overwriting
.Ar target .
.
.It Fl L
Takes actions based on the type and contents of the file referenced by any
symbolic link specified as a
.Ar source_file
operand or any symbolic links encountered during traversal of a file hierarchy.
.Pp
Copies files referenced by symbolic links.
Symbolic links encountered during traversal of a file hierarchy are not
preserved.
.
.It Fl p
Preserve.
The
.Nm
utility duplicates not only the contents of
.Ar source_file ,
but also attempts to preserve its ACL, access and
modification times, extended attributes, extended system attributes, file mode,
and owner and group ids.
.Pp
If
.Nm
is unable to preserve the access and modification times, extended
attributes, or the file mode,
.Nm
does not consider it a failure.
If
.Nm
is unable to preserve the owner and group id, the copy does not fail, but
.Nm
silently clears the
.Dv S_ISUID
and
.Dv S_ISGID
bits from the file mode of the target.
The copy fails if
.Nm
is unable to clear these bits.
If
.Nm
is unable to preserve the ACL or extended system attributes,
the copy fails.
If the copy fails, then a diagnostic message is written to
.Va stderr
and (after processing any remaining operands)
.Nm
exits with a non-zero exit status.
.
.It Fl P
Takes actions on any symbolic link specified as a
.Ar source_file
operand or any symbolic link encountered during traversal of a file hierarchy.
.Pp
Copies symbolic links.
Symbolic links encountered during traversal of a file hierarchy are preserved.
.
.It Fl r
Recursive.
The
.Nm
utility copies the directory and all its files, including any
subdirectories and their files to
.Ar target .
Unless the
.Fl H , L , No or Fl R
option is specified, the
.Fl L
option is used as the default mode.
.
.It Fl R
Same as
.Fl r ,
except pipes are replicated, not read from.
.
.It Fl @
Preserves extended attributes.
The
.Nm
utility attempts to copy all of the source
file's extended attributes along with the file data to the destination file.
.
.It Fl /
Preserves extended attributes and extended system attributes.
Along with the file's data, the
.Nm
utility attempts to copy extended attributes and
extended system attributes from each source file, and extended system
attributes associated with extended attributes to the destination file.
If
.Nm
is unable to copy extended attributes or extended system attributes,
then a diagnostic message is written to
.Va stderr
and (after processing any remaining operands) exits with a non-zero exit status.
.El
.Lp
Specifying more than one of the mutually-exclusive options
.Fl H , L ,  No and Fl P
is not considered an error.
The last option specified determines the behavior of the utility.
.Pp
Likewise, when both
.Fl p
and either the
.Fl @
or
.Fl /
options are specified, the last option specified determines the behavior
of the utility.
.
.Sh OPERANDS
The following operands are supported:
.Bl -tag -width Ar
.It Ar source_file
A pathname of a regular file to be copied.
.It Ar source_dir
A pathname of a directory to be copied.
.It Ar target_file
A pathname of an existing or non-existing file, used for the output when a
single file is copied.
.It Ar target
A pathname of a directory to contain the copied files.
.El
.Sh USAGE
See
.Xr largefile 5
for the description of the behavior of
.Nm
when encountering files greater than or equal to 2 Gbyte (2^31 bytes).
.
.Sh ENVIRONMENT VARIABLES
See
.Xr environ 5
for descriptions of the following environment variables
that affect the execution of
.Nm :
.Ev LANG , LC_ALL , LC_COLLATE , LC_CTYPE , LC_MESSAGES ,
and
.Ev NLSPATH .
.Lp
Affirmative responses are processed using the extended regular expression
defined for the
.Sy yesexpr
keyword in the
.Sy LC_MESSAGES
category of the user's locale.
The locale specified in the
.Sy LC_COLLATE
category defines the behavior of ranges, equivalence classes, and
multi-character collating
elements used in the expression defined for
.Sy yesexpr .
The locale specified in
.Sy LC_CTYPE
determines the locale for interpretation of sequences of
bytes of text data a characters, the behavior of character classes used in the
expression defined for the
.Sy yesexpr .
See
.Xr locale 5 .
.
.Sh EXIT STATUS
.Ex -std
.Sh EXAMPLES
.Ss Example 1 Copying a File
The following example copies a file:
.Bd -literal -offset indent
example% cp goodies goodies.old

example% ls goodies*
goodies goodies.old
.Ed
.
.Ss Example 2 Copying a List of Files
The following example copies a list of files to a destination directory:
.Bd -literal -offset indent
example% cp ~/src/* /tmp
.Ed
.
.Ss Example 3 Copying a Directory
The following example copies a directory, first to a new, and then to an
existing destination directory:
.
.Bd -literal -offset indent
example% ls ~/bkup
/usr/example/fred/bkup not found

example% cp -r ~/src ~/bkup

example% ls -R ~/bkup
x.c y.c z.sh

example% cp -r ~/src ~/bkup

example% ls -R ~/bkup
src x.c y.c z.sh
src:
x.c y.c z.s
.Ed
.
.Ss Example 4 Copying Extended File System Attributes
The following example copies extended file system attributes:
.
.Bd -literal -offset indent
$ ls -/ c file1
-rw-r--r--   1 foo   staff          0 Oct 29 20:04 file1
                {AH-----m--}

$ cp -/ file1 file2
$ ls -/c file2
-rw-r--r--   1 foo  staff          0 Oct 29 20:17 file2
                {AH-----m--}
.Ed
.Ss Example 5 Failing to Copy Extended System Attributes
The following example fails to copy extended system attributes:
.
.Bd -literal -offset indent
$ ls -/c file1
-rw-r--r--   1 foo    staff          0 Oct 29 20:04 file1
                {AH-----m--}

$ cp -/ file1 /tmp
cp: Failed to copy extended system attributes from file1 to /tmp/file1


$ ls -/c /tmp/file1
-rw-r--r--   1 foo    staff          0 Oct 29 20:09 /tmp/file1
                {}
.Ed
.
.Sh CODE SET INDEPENDENCE
.Sy Enabled .
.Sh INTERFACE STABILITY
.Sy Committed .
.
.Sh SEE ALSO
chmod 1 ,
chown 1 ,
setfacl 1 ,
utime 2 ,
fgetattr 3C ,
environ 5 ,
fsattr 5 ,
largefile 5 ,
locale 5 ,
standards 5
.
.Sh NOTES
The permission modes of the source file are preserved in the copy.
.Lp
A
.Fl -
permits the user to mark the end of any command line options
explicitly, thus allowing
.Nm
to recognize filename arguments that begin with a
.Fl .
